import{h as $,_ as z,i as H,r as d,o as T,a as B,b as n,c as l,d as e,t as o,e as r,f as x,j as b,F as R,g as U,w as A,p as F,k as M}from"./index-9f4cf9f0.js";import{P as O}from"./PostService-0fa92c71.js";import{_ as q}from"./MathRenderer-355883fb.js";const D="http://localhost:3000/comments";class G{async fetchComments(c){return(await $.get(`${D}/${c}`)).data}async addComment(c,i,f){return(await $.post(`${D}/${c}`,{content:i},{headers:{Authorization:`Bearer ${f}`}})).data}async addReply(c,i,f){return(await $.post(`${D}/${c}/reply`,{content:i},{headers:{Authorization:`Bearer ${f}`}})).data}}const C=m=>(F("data-v-9f90b2df"),m=m(),M(),m),J={class:"grid"},K={class:"col-12"},Q={class:"card"},W={key:0},X={class:"flex flex-row gap-2 mt-4 align-items-center"},Y={class:"text-gray-500"},Z={class:"surface-100 p-1",style:{"border-radius":"30px"}},ee={class:"surface-0 flex align-items-center gap-2 justify-content-center py-1 px-2",style:{"border-radius":"30px","box-shadow":"0px 1px 2px 0px rgba(0, 0, 0, 0.04), 0px 1px 2px 0px rgba(0, 0, 0, 0.06)"}},te={class:"text-900 font-medium text-sm"},oe=C(()=>e("i",{class:"pi pi-thumbs-up"},null,-1)),ae={class:"font-medium"},se={class:"font-medium"},ne={key:0},le=C(()=>e("strong",null,"업로드한 파일:",-1)),re=["href","download"],ce={class:"flex flex-column mt-4 align-items-center justify-center"},ie={class:"flex gap-2"},de=C(()=>e("h3",null,"댓글",-1)),ue={key:0},_e={key:0,class:"reply"},pe={key:0},ve={key:1},he=C(()=>e("p",null,"로그인 후 댓글을 작성할 수 있습니다.",-1)),me=[he],fe={__name:"postHowto",setup(m){const c=new O,i=new G,f=H(),p=d(f.params.postId),a=d(null),k=localStorage.getItem("token"),P=async()=>{try{const t=await c.updateLike(k,p.value);a.value=t}catch(t){console.error("Error updating like:",t)}},I=d([]),y=d(""),g=d({}),S=d(!1),V=d(null),E=d(""),L=async()=>{try{I.value=await i.fetchComments(p.value)}catch(t){console.error("Error fetching comments:",t)}},j=async()=>{if(y.value)try{await i.addComment(p.value,y.value,k),y.value="",await L()}catch(t){console.error("Error adding comment:",t)}},N=async t=>{if(g.value[t])try{await i.addReply(t,g.value[t],k),g.value[t]="",await L()}catch(u){console.error("Error adding reply:",u)}};return T(async()=>{try{const t=await c.getPostById(p.value);if(a.value=t.post,t.file){V.value=t.file;const u=atob(V.value),v=[];for(let h=0;h<u.length;h++)v.push(u.charCodeAt(h));const w=new Blob([new Uint8Array(v)],{type:"application/octet-stream"});E.value=URL.createObjectURL(w)}}catch(t){console.error("Error fetching post:",t)}try{await L(),S.value=!!k}catch(t){console.error("Error fetching comments:",t)}}),(t,u)=>{const v=B("Divider"),w=B("Button"),h=B("Textarea");return n(),l("div",J,[e("div",K,[e("div",Q,[a.value?(n(),l("div",W,[e("h2",null,o(a.value.title),1),e("div",null,[e("div",X,[e("div",Y,o(new Date(a.value.date).toLocaleString()),1),e("div",Z,[e("div",ee,[e("div",te,o(a.value.like),1),oe])])]),e("div",null,o(a.value.author.schoolID)+" "+o(a.value.author.name),1)]),r(v),e("div",ae,o(a.value.content1),1),r(v),e("div",se,[r(q,{content:a.value.content2},null,8,["content"])]),V.value?(n(),l("p",ne,[le,x(),e("a",{href:E.value,download:a.value.originalname},o(a.value.filename),9,re)])):b("",!0),e("div",null,[e("div",ce,[e("div",ie,[r(w,{label:t.isLiked?"좋아요 취소":"좋아요",icon:"pi pi-thumbs-up",onClick:P},null,8,["label"])])])]),r(v),e("div",null,[de,e("div",null,[(n(!0),l(R,null,U(I.value,s=>(n(),l("div",{key:s._id},[s.isReply?b("",!0):(n(),l("div",ue,[e("p",null,[e("strong",null,o(s.author.name)+":",1),x(" "+o(s.content),1)]),e("small",null,o(new Date(s.date).toLocaleString()),1),(n(!0),l(R,null,U(s.replies,_=>(n(),l("div",{key:_._id,class:"reply"},[e("p",null,[e("strong",null,o(_.author.name)+":",1),x(" "+o(_.content),1)]),e("small",null,o(new Date(_.date).toLocaleString()),1)]))),128)),S.value?(n(),l("div",_e,[r(h,{modelValue:g.value[s._id],"onUpdate:modelValue":_=>g.value[s._id]=_,class:"resize-none",placeholder:"답글을 입력하세요"},null,8,["modelValue","onUpdate:modelValue"]),r(w,{onClick:_=>N(s._id)},{default:A(()=>[x("답글 추가")]),_:2},1032,["onClick"])])):b("",!0)]))]))),128))]),S.value?(n(),l("div",pe,[r(h,{modelValue:y.value,"onUpdate:modelValue":u[0]||(u[0]=s=>y.value=s),placeholder:"댓글을 입력하세요"},null,8,["modelValue"]),r(w,{onClick:j},{default:A(()=>[x("댓글 추가")]),_:1})])):(n(),l("div",ve,me))])])):b("",!0)])])])}}},xe=z(fe,[["__scopeId","data-v-9f90b2df"]]);export{xe as default};
